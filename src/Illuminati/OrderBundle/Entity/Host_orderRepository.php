<?php

namespace Illuminati\OrderBundle\Entity;

use Doctrine\Orm\Repository;
/**
 * Host_orderRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class Host_orderRepository extends \Doctrine\ORM\EntityRepository
{
    public function findParticipantsOrders($id)
    {
        return $this->getEntityManager()
            ->createQuery(
                'SELECT u,ur,urd,p FROM Illuminati\UserBundle\Entity\User u
                    INNER JOIN Illuminati\OrderBundle\Entity\User_order ur WITH (u.id = ur.usersId)
                    INNER JOIN Illuminati\OrderBundle\Entity\Host_order ho WITH (ho.id = ur.hostOrderId)
                    LEFT JOIN Illuminati\OrderBundle\Entity\User_order_details urd WITH (ur.id = urd.userOrderId )
                    LEFT JOIN Illuminati\ProductBundle\Entity\Product p WITH (urd.productId = p.id)
                    WHERE ur.deleted = 0 AND ho.deleted = 0 AND ho = '.$id.' GROUP BY u.id'
            )->getResult();
    }
}
